# tdd-development-iterate-green-refactor

## 目的
テストケースごとのRed→Green→Refactorサイクルを確実に回し、各ケースで最小実装とリファクタリングを段階的に行う。品質を損なわずに実装を積み上げ、重複や設計負債を逐次解消する。

## 入力前提
- `/generate-test-cases` と `/generate-test-skeleton` の成果物、ならびに `/implement-green-phase` の実装案がコンテキストにある。
- 実行順序が明記されたテストケース一覧（ID付き）が把握できる。未定の場合は優先順位決定を支援する。
- 現在失敗しているテストと、これから着手するテストケースが特定できる。

## 手順
1. テストケースをID順または優先度順に並べ、1つずつ処理する計画を共有する。
2. 反復の各ステップで以下を実施する。
   1. **Red確認**: 対象テストが失敗しているか確認し、失敗理由を要約する。必要ならテストコードの修正案を提示する。
   2. **Green実装**: `/implement-green-phase` の指針を参照し、最小限の実装または修正案を提示する。過剰実装リスクを常に警告する。
   3. **検証**: 対象テストおよび影響範囲のテストコマンド（例: `pytest <target>`）を提案し、想定結果を述べる。
   4. **Refactor**: 重複コード・命名・責務分割など改善案を提示し、リファクタ後のコード例を示す。リファクタで挙動が変わらない根拠を添える。
   5. **再検証**: リファクタ後に再度テストを実行するよう提案し、結果確認を依頼する。
3. 各テストケースの完了後、得られた学びや次のテストに備える注意点をメモとして残す。
4. すべてのテストケース完了後、リグレッション観点や追加の総合テストが必要か確認する。

## 出力フォーマット
- 冒頭に対象テストケースのID・シナリオ・関連仕様IDを箇条書きで整理する。
- 続いて、反復ステップを`Red`, `Green`, `Refactor`, `テスト再実行`, `メモ`といった見出し付きの小セクションにまとめる。
- 実装案・リファクタ案はコードブロックまたは`diff`形式で提示する。コメントには`SPEC: XXX / TC-YY`形式を用いる。
- セクション末尾で、次に着手すべきテストケースIDと準備事項を挙げる。

## 応対スタイル
- 丁寧な敬体で、各判断の根拠を必ず添える。
- ユーザーの意向を尊重しつつ、リファクタリングの目的と効果を論理的に説明する。
- 過剰な抽象化や時期尚早な最適化を避けるよう注意喚起する。
- テストが安定しない場合は代替戦略や追加の確認事項を提案する。
